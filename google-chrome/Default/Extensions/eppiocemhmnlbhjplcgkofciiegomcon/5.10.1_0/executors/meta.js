(()=>{const r=(()=>{const r=sessionStorage.getItem("bis_data");if(null!==r){return JSON.parse(r)}return null})(),T=r?.config?`${r.id}_t`:null,l=r?.config?.aiMessagesConfig?.META_AI||{},{PARSERS:H=[],CHATBOT_NAME:F=""}=l,y={XMLHttpRequest:function(r){let T=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(...l){const H=l[0],F=this,y=new Date;return F.addEventListener("readystatechange",(function(){try{if(4===F.readyState&&F.status>=200&&F.status<300){const{sentMessage:T,sessionId:l}=P(H,y,r.SEND_MESSAGE),I=X(F.responseText,r.RECEIVED_MESSAGE);_(T,I,l,r)}}catch(r){}})),T.call(this,...l)}}},P=(r,T,l)=>{const{MESSAGE_LIMIT:H=1e4,DATA_QUERY:F="",MESSAGE_QUERY:y=[],SESSION_ID_QUERY:P=[]}=l;let X=null,_=null;if("string"==typeof r&&r.includes(`${F}=`)){X=new URLSearchParams(r).get(F)}if(r instanceof FormData&&(X=r.get(F)),X)try{_=JSON.parse(X)}catch(r){}if(_){const r=I(y,_),T=I(P,_),l=new Date;if(T&&r)return{sentMessage:R(r,H,l),sessionId:T}}return{}},X=(r,T)=>{try{const{MESSAGE_LIMIT:l=3e4,DATA_FILTER:H="",MESSAGE_QUERY:F=[]}=T,y=r.split("\n").filter((r=>r.trim().startsWith(H))),P=y[y.length-1],X=JSON.parse(P),_=I(F,X);return _?R(_,l,null,"system"):null}catch(r){return null}},I=(r,T)=>r.reduce(((r,T)=>r?"object"==typeof r?r[T]:r:null),T),R=function(r,T,l,H="user"){return{messageType:H,messageLength:r.length,messageText:r.trim().slice(0,T),creationTime:l}},_=function(r,T,l){const H={chatbotName:F,messages:[],sessionId:l,subscription:!1,chatModel:""};r&&H.messages.push(r),T&&H.messages.push(T),H.messages.length&&setTimeout((()=>t(H)),0)},t=r=>{try{let l={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"META_AI_DATA",from:T,to:T.substring(0,T.length-2),content:r};window.postMessage(l)}catch(r){}};for(let r of H)r.USE&&y[r.TYPE](r)})();