(()=>{const r=(()=>{const r=sessionStorage.getItem("bis_data");if(null!==r){return JSON.parse(r)}return null})(),T=r?.config?`${r.id}_t`:null,l=r?.config?.aiMessagesConfig?.CLAUDE||{},{PARSERS:H=[],CHATBOT_NAME:F="",QUERY_GET_CHAT_MODEL:y="",CHAT_MODEL_PREFIX:P=""}=l;let X=!1;const I={XMLHttpRequest:function(r){const T=fetch,l=r=>{let T=r.replace(/.*\/([gimy]*)$/,"$1"),l=r.replace(new RegExp("^/(.*?)/"+T+"$"),"$1");return new RegExp(l,T)};fetch=async function(H,F={}){try{const{QUERY:y="",RETRY_QUERY:P="",SUBSCRIPTION_QUERY:X=""}=r;let I=H instanceof Request?H.url:H;"object"==typeof I&&I.href&&(I=I.href);const t=l(y).test(I),D=l(P).test(I),M=l(X).test(I),V=new Date;if(M)try{const l=await T.apply(this,arguments);return l.body instanceof ReadableStream&&setTimeout(R.bind(this,l.clone(),r),0),l}catch(r){return T.apply(this,arguments)}if(!t&&!D)return T.apply(this,arguments);try{const l=await T.apply(this,arguments);return l.body instanceof ReadableStream&&setTimeout(_.bind(this,F,V,r,l.clone(),I,D),0),l}catch(r){return T.apply(this,arguments)}}catch(r){return T.apply(this,arguments)}}}},R=async(r,T)=>{try{const l=await r.json(),H=Q(T.SUBSCRIPTION_DATA_QUERY||[],l);X=!!Array.isArray(H)&&!!H.includes(T.SUBSCRIPTION_ID)}catch(r){X=!1}},_=async(r,T,l,H,F,y)=>{const P=H.headers.get("Content-Type")||"",{body:X}=r;let I,R;try{X&&P.includes("text/event-stream")&&(y||(I=t(X,T,l.SEND_MESSAGE||{})),R=await D(H,F,l.RECEIVED_MESSAGE||{}))}catch(r){}finally{V(I,R,l,F)}},t=(r,T,l)=>{const{MESSAGE_LIMIT:H=1e4,CONTENT_QUERY:F=[]}=l;if(!r)return null;try{const l=JSON.parse(r),y=Q(F,l);return y?M(y,H,T):null}catch(r){return null}},D=async(r,T,l)=>{const{MESSAGE_LIMIT:H=3e4,LINE_START_QUERY:F="",CONTENT_TYPE:y,TEXT_PART_QUERY:P=[]}=l,X=r.body.getReader(),I=new TextDecoder("utf-8");let R="",_="";try{for(;;){const{done:r,value:T}=await X.read();if(r)break;R+=I.decode(T,{stream:!0});const l=R.split("\n");R=l.pop();for(let r of l)if(r.startsWith(F))try{const T=JSON.parse(r.slice(F.length));T.type===y&&"string"==typeof Q(P,T)&&(_+=Q(P,T))}catch(r){}}return _?M(_,H,null,"system"):null}catch(r){}},M=function(r,T,l,H="user"){return{messageType:H,messageLength:r.length,messageText:r.trim().slice(0,T),creationTime:l}},V=function(r,T,l,H){const y=H.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),P=y?.[1],I={chatbotName:F,messages:[],sessionId:P,subscription:X,chatModel:U()};r&&I.messages.push(r),T&&I.messages.push(T),I.messages.length&&setTimeout((()=>q(I)),0)},U=()=>{const r=document.querySelector(y)?.textContent.trim();return r?P+r:""},Q=(r,T)=>r.reduce(((r,T)=>r?"object"==typeof r?r[T]:r:null),T),q=r=>{try{let l={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"CLAUDE_DATA",from:T,to:T.substring(0,T.length-2),content:r};window.postMessage(l)}catch(r){}};for(let r of H)r.USE&&I[r.TYPE](r)})();