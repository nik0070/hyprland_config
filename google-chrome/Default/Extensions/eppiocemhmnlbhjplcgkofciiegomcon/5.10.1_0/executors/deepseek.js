(()=>{const r=(()=>{const r=sessionStorage.getItem("bis_data");return null!==r?JSON.parse(r):null})(),T=r?.config?`${r.id}_t`:null,l=r?.config?.aiMessagesConfig?.DEEPSEEK||{},{PARSERS:H=[],CHATBOT_NAME:F=""}=l,y=function(r,l,H,y){let I={chatbotName:F,chatModel:"",subscription:!1,messages:[]},R={},_={};if(r?.length){let T=JSON.parse(r);P(I,T,y.GENERAL_DATA.GET_BY_PATH),function(r,T,l,H){try{if(P(r,T,H.RULES_GET_USER_VALUES),!r?.messageText)return null;r.creationTime=l,X(r,H?.MESSAGE_LIMIT||1e4)}catch(r){}}(R,T,l,y.SENT_MESSAGE)}!function(r,T,l){if(!T?.length)return null;try{if(P(r,T,l.RULES_GET_SYSTEM_VALUES),!r?.messageText)return null;X(r,l?.MESSAGE_LIMIT||3e4)}catch(r){}}(_,H,y.RECEIVED_MESSAGE),R?.messageText&&I.messages.push(R),_?.messageText&&I.messages.push(_),I.messages.length&&setTimeout((()=>(r=>{try{let l={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"DEEPSEEK_DATA",from:T,to:T.substring(0,T.length-2),content:r};window.postMessage(l)}catch(r){}})(I)),0)},P=function(r,T,l){for(let H of l)H.PATH?.length?"payload"===H.SOURCE?r[H.NAME]=_.byPath(T,H.PATH):r[H.NAME]=_.byPath(null,H.PATH):H.REDUCE_PARAMS?r[H.NAME]=_.byReduce(T,H.REDUCE_PARAMS):H.CONSTANT_VALUE&&(r[H.NAME]=H.CONSTANT_VALUE)},X=function(r,T){let l=r.messageText;r.messageText=l.trim().slice(0,T),r.messageLength=l.length},I=async function(r,T,l,H){let F=[];try{let T=r.split("\n");for(let r=0;r<T.length;r++){const l=T[r].trim();if(l.startsWith("data:")){const r=l.slice(5).trim();try{F.push(JSON.parse(r))}catch(r){}}}}catch(r){}finally{y(T,l,F,H)}},R={XMLHttpRequest:function(r){const T=XMLHttpRequest.prototype.open,l=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(r,l){return this._requestMethod=r,this._requestUrl=l,T.apply(this,arguments)},XMLHttpRequest.prototype.send=function(T){let H=this.onreadystatechange;const F=new Date;return this.onreadystatechange=function(){if(4===this.readyState&&function(r,T,l){return new RegExp(l.REGEXP_URL_CHECK).test(r)&&T===l.REQUEST_METHOD}(this._requestUrl,this._requestMethod,r)&&setTimeout(I.bind(this,this.responseText,T,F,r),0),H)return H.apply(this,arguments)},l.apply(this,arguments)}}},_={byReduce:(r,T)=>{const{KEY:l,INVALID_VALUES:H,TYPE:F,RED_FLAG_PATH:y,RED_FLAG_VALUE:P}=T;if(y?.length)for(let T of r){let r=T;for(let T=0;T<y.length;T++){const l=y[T];if(!r[l]){r=null;break}r=r[l]}if(r===P)return null}return r.reduce(((r,T)=>(T.hasOwnProperty(l)?typeof T[l]===F&&H.some((r=>T[l]!==r))&&(r+=T[l]):r+="",r)),"")},byPath:(r,T)=>{for(let l=0;l<T.length;l++){const H=T[l];if(!r[H]){r=null;break}r=r[H]}return r}};!function(){for(let r of H)r.USE&&R[r.TYPE](r)}()})();