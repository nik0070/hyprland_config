(()=>{const r=(()=>{const r=sessionStorage.getItem("bis_data");if(null!==r){return JSON.parse(r)}return null})(),T=r?.config?`${r.id}_t`:null,l=r?.config?.aiMessagesConfig?.GROK||{},{PARSERS:H=[],CHATBOT_NAME:F=""}=l;let y=null,P=null;const X={XMLHttpRequest:function(r){const T=fetch;fetch=async function(l,H={}){try{const{QUERY:F=""}=r;let y=l instanceof Request?l.url:l;"object"==typeof y&&y.href&&(y=y.href);const P=(r=>{let T=r.replace(/.*\/([gimy]*)$/,"$1"),l=r.replace(new RegExp("^/(.*?)/"+T+"$"),"$1");return new RegExp(l,T)})(F).test(y),X=new Date;if(!P)return T.apply(this,arguments);try{const l=await T.apply(this,arguments);return l.body instanceof ReadableStream&&setTimeout(I.bind(this,H,X,r,l.clone(),y),0),l}catch(r){return T.apply(this,arguments)}}catch(r){return T.apply(this,arguments)}}}},I=async(r,T,l,H,F)=>{const{body:y}=r;let X,I;P=null;try{y&&(X=R(y,T,l.SENT_MESSAGE||{}),I=await _(H,F,l.RECEIVED_MESSAGE||{}))}catch(r){}finally{D(X,I,l,F)}},R=(r,T,l)=>{const{MESSAGE_LIMIT:H=1e4,CONTENT_QUERY:F=[],MODEL_QUERY:P=[]}=l;if(!r)return null;try{const l=JSON.parse(r),X=M(F,l);return y=M(P,l),X?t(X,H,T):null}catch(r){return null}},_=async(r,T,l)=>{const{MESSAGE_LIMIT:H=3e4,SESSION_ID_QUERY:F=[],CONTENT_QUERIES:y=[]}=l;let X="";const I=r.body.getReader(),R=new TextDecoder("utf-8");try{for(;;){const{done:r,value:T}=await I.read();if(r)break;X+=R.decode(T,{stream:!0})}const r=X.trim().split("\n").map((r=>{try{return JSON.parse(r)}catch(r){return null}})).filter(Boolean),T=r.find((r=>M(F,r)));T&&(P=M(F,T));const l=r.find((r=>y.some((T=>M(T,r)))));if(!l)return;const _=M(y.find((r=>M(r,l))),l);return _?t(_,H,null,"system"):null}catch(r){}},t=function(r,T,l,H="user"){return{messageType:H,messageLength:r.length,messageText:r.trim().slice(0,T),creationTime:l}},D=function(r,T,l,H){const{FREE_MODEL_QUERY:X=""}=l,I=H.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),R={chatbotName:F,messages:[],sessionId:P||I?.[0],subscription:X!==y,chatModel:y};r&&R.messages.push(r),T&&R.messages.push(T),R.messages.length&&setTimeout((()=>V(R)),0)},M=(r,T)=>r.reduce(((r,T)=>r?"object"==typeof r?r[T]:r:null),T),V=r=>{try{let l={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"GROK_DATA",from:T,to:T.substring(0,T.length-2),content:r};window.postMessage(l)}catch(r){}};for(let r of H)r.USE&&X[r.TYPE](r)})();