(()=>{function r(){function r(){return(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22)}const T=function(){let T=sessionStorage.getItem("bis_data");if(null!==T)return JSON.parse(T);try{let T={posdMessageId:"PANELOS_MESSAGE",posdHash:r(),type:"CONFIG_NOT_FOUND",from:"",to:"",content:"configuration not found"};window.postMessage(T)}catch(r){}return null}(),l=T?T.config.facebookConfig.videoDetectorConfigNew:null,H=T?T.id+"_w":null;const F="SCRIPT",y="XML_HTTP_REQUEST",P="INSTREAM_CONFIG",X="MARKETPLACE_VIDEO_AD",I="FEED_VIDEO_AD",R=function(r,T,l="",H="",F="",y="",P="",X="",I="",R=""){return{detectionTime:Date.now()/1e3|0,videoId:r,videoUrl:T,previewImageUrl:H,audioUrl:l,linkDisplay:F,userName:y,adName:P,adLogo:X,videoResolutionId:I,audioResolutionId:R}},_=function(r,T){const l=new RegExp(T,"i"),H=r.match(l),F=T.match(new RegExp("\\?<(?<groupName>.[^>]*)>"))?.groups.groupName;if(!H)return"";if(H.groups&&F)return 0===H.groups[F].search(/"/)?H.groups[F].replace(/"/,""):H.groups[F];let y=H.filter((r=>r));return!!y[1]&&y[1]},t=function(r,T){try{let l=T.replace(/}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const H=r.CHECKER;l=l.filter((r=>H.some((T=>new RegExp(T).test(r)))));const F=[];if(l.length){for(let T of l){let l=T;"string"==typeof T&&(l=JSON.parse(T));const H=e(l,r),y=b(l,r),P=d(l,r),X=q(l,r.PATH_USER_NAME),I=q(l,r.PATH_VIDEO_REPRESENTATION_ID,parseInt(P)),_=q(l,r.PATH_AUDIO_REPRESENTATION_ID,parseInt(P)),t=R(P,H,"",y,"",X,"","",I,_);P&&H&&F.push(t)}F.forEach((r=>{setTimeout(p(r,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(r){}},D=function(r,T,l){let H=[];const F=[];try{H.push(JSON.parse(T)),setTimeout(p({url:l,requestMethod:"POST",content:H},"FACEBOOK_INSTREAM_DATA"),0)}catch(y){H=T.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g),H.forEach((T=>{if(T.length<=3||!r.CHECKER.some((r=>T.includes(r))))return;let l=JSON.parse(T),H=l,y=l;for(let T of r.PATH_NODES){const l=r.PATH_NODES.indexOf(T),y=r.PATH_NODES.length-1;l!==y&&H[T]&&(H=H[T]),l===y&&H[T]&&(H=H[T],H.length?H.forEach((T=>{T.bisLinks={aboutPageLink:V(T,r.PATH_USER_ID)},T.video_id=M(T,r.PATH_VIDEO_ID),F.push(T)})):(H.bisLinks={aboutPageLink:V(H,r.PATH_USER_ID)},H.video_id=M(H,r.PATH_VIDEO_ID),F.push(H)))}for(let T of r.PATH_ALL_VIDEO){const l=r.PATH_ALL_VIDEO.indexOf(T),H=r.PATH_ALL_VIDEO.length-1;if(l!==H&&y[T]&&(y=y[T]),"string"!=typeof T&&l===H&&T.length)if(y.length)y.forEach(((r,l)=>{const H=F[l];if(H.video_id===r.video_id)for(let l of T)if(r[l]){H[l]=r[l];break}}));else if(1===F.length){const r=F[0];if(r.video_id===y.video_id)for(let l of T)if(y[l]){r[l]=y[l];break}}}})),F.forEach((r=>{setTimeout(p({url:l,requestMethod:"POST",content:r},"FACEBOOK_INSTREAM_DATA"),0)}))}},M=function(r,T){let l=r,H=null;for(let r of T){const F=T.indexOf(r),y=T.length-1;F!==y&&l[r]&&(l=l[r]),F===y&&l[r]&&(H=l[r])}return parseInt(H,10)},V=function(r,T){let l=r,H=null;for(let r of T){const F=T.indexOf(r),y=T.length-1;F!==y&&l[r]&&(l=l[r]),F===y&&l[r]&&(H=`https://www.facebook.com/${l[r]}/about`)}return H},U=function(r,T){T=T.replace(/ /g,"");const H=_(T,r.VIDEO_ID);if(!H)return;let F=null,y=null,P="",X="",I="",t="",D="";r.VIDEO_HD_URL&&(F=_(T,r.VIDEO_HD_URL)),r.VIDEO_SD_URL&&!F&&(y=_(T,r.VIDEO_SD_URL)),r.LINK_DISPLAY&&(I=_(T,r.LINK_DISPLAY)),l.VIDEO_AUDIO_URL&&(P=_(T,r.VIDEO_AUDIO_URL),P=P?P.split("\\").join(""):P),r.THUMBNAIL&&(X=_(T,r.THUMBNAIL),X=X?X.split("\\").join(""):X),r.VIDEO_REPRESENTATION_ID&&(t=_(T,r.VIDEO_REPRESENTATION_ID)),r.AUDIO_REPRESENTATION_ID&&(D=_(T,r.AUDIO_REPRESENTATION_ID));let M=F||y;if(M){M=M.split("\\").join("");const r=R(H,M,P,X,I,"","","",t,D);setTimeout(p(r,"FACEBOOK_VIDEO_DATA"),0)}},Q=function(r,T){try{let l=T.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const H=r.CHECKER;l=l.filter((r=>H.some((T=>new RegExp(T).test(r)))));const F=[];if(l.length){for(let T of l){let l=T;"string"==typeof T&&(l=JSON.parse(T));const H=B(l,r),y=e(l,r),P=b(l,r),X=d(l,r),I=q(l,r.PATH_NAME),_=q(l,r.PATH_LOGO),t=q(l,r.PATH_VIDEO_REPRESENTATION_ID,parseInt(X)),D=q(l,r.PATH_AUDIO_REPRESENTATION_ID,parseInt(X)),M=R(X,y,H,P,"","",I,_,t,D);X&&y&&F.push(M)}F.forEach((r=>{setTimeout(p(r,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(r){}},q=function(r,T,l=null){let H="";for(const F of T){const T=F.length;let y=r;for(let r=0;r<T;r++){const P=F[r],X=T-1;if("*"===P&&l){if([y]=y.filter((r=>l===parseInt(r.video_id))),!y)break}else if(P<0)y=y.slice(P,y.length)[0];else{if(!y[P])break;if(r===X){H=y[P];break}r!==X&&(y=y[P])}}}return H},B=function(r,T){let l="";for(const H of T.PATH_AUDIO_URL){const T=H.length;let F=r;for(let r=0;r<T;r++){const y=H[r],P=T-1;if(!F[y])break;r!==P&&F[y]&&(F=F[y]),r===P&&F[y]&&(l=F[y])}}return l},e=function(r,T){let l=null;for(const H of T.PATH_VIDEO_URL){const T=H.length;let F=r;for(let r=0;r<T;r++){const y=H[r],P=T-1;if(!F[y]&&y.includes&&!y.includes("%%%"))break;if(r!==P&&F[y]&&(F=F[y]),y.includes&&y.includes("%%%")){let[T,H]=y.split("%%%");if(F[T]||F[H]){if(r===P){l=F[T]?F[T]:F[H];break}F=F[T]?F[T]:F[H]}}r===P&&F[y]&&(l=F[y])}}return l},b=function(r,T){let l=null;for(const H of T.PATH_THUMBNAIL){const T=H.length;let F=r;for(let r=0;r<T;r++){const y=H[r],P=T-1;if(!F[y])break;r!==P&&F[y]&&(F=F[y]),r===P&&F[y]&&(l=F[y])}}return l},d=function(r,T){let l=null;for(const H of T.PATH_VIDEO_ID){const T=H.length;let F=r;for(let r=0;r<T;r++){const y=H[r],P=T-1;if(!F[y])break;r!==P&&F[y]&&(F=F[y]),r===P&&F[y]&&(l=F[y])}}return l},n=function(r,T,H=null){const F=function(r,T){T=String(T);const H=l.PARSER_CONFIG[r];return H.SEPARATOR?T.split(H.SEPARATOR):[T]}(T,r);F.forEach((r=>{setTimeout((()=>function(r,T=null,H=null){const F=T?l.PARSERS.filter((r=>r.TYPE===T)):l.PARSERS;for(const l of F)if(l.CHECKER.some((T=>r.includes(T))))try{switch(T){case P:setTimeout((()=>D(l,r,H)),0);break;case X:setTimeout((()=>Q(l,r,H)),0);break;case I:setTimeout((()=>t(l,r,H)),0);break;default:setTimeout((()=>U(l,r)),0)}}catch(r){}}(r,T,H)),0)}))},p=function(T,l){return function(){!function(T,l,H){let F;try{F={posdMessageId:"PANELOS_MESSAGE",posdHash:r(),type:H,from:T,to:T.substring(0,T.length-2),content:l},window.postMessage(F)}catch(r){}}(H,T,l)}};if(l?.PARSER_CONFIG.SCRIPT.USE){const r=function(){const r=document.querySelectorAll("script");for(const T of r)T.hasAttribute("bis_use")||(T.setAttribute("bis_use","true"),n(T.innerHTML,F))};r(),setInterval(r,l.PARSER_CONFIG.SCRIPT.INTERVAL_MS||5e3)}if(l?.PARSER_CONFIG.LISTEN_HTTP_REQUESTS){let r=XMLHttpRequest.prototype.open,T=XMLHttpRequest.prototype.setRequestHeader,H=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.setRequestHeader=function(){const r=arguments[0].toLowerCase(),l=arguments[1];this.requestHeaders||(this.requestHeaders={}),this.requestHeaders[r]=l,T.apply(this,arguments)},XMLHttpRequest.prototype.open=function(){this.requestMethod=arguments[0],r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){let r=this.onreadystatechange;return this.onreadystatechange=function(){const T=l.MATCH_URLS,H=l.MATCH_HEADERS,F=this.requestHeaders?Object.keys(this.requestHeaders):null,R=l.PARSER_CONFIG.INSTREAM_CONFIG,_=l.PARSER_CONFIG.MARKETPLACE_VIDEO_AD,t=l.PARSER_CONFIG.FEED_VIDEO_AD;let D=!1,M=null,V=null;if(F&&(D=F.some((r=>{if(H[r]&&H[r].includes(this.requestHeaders[r]))return M=r,V=this.requestHeaders[r],!0}))),4===this.readyState&&T.filter((r=>r.indexOf(this.responseURL))).length>0)if(D)switch(!0){case R.USE&&R.HEADERS[M].includes(V):setTimeout((()=>n(this.response,P,this.responseURL)),0);break;case _.USE&&_.HEADERS[M].includes(V):setTimeout((()=>n(this.response,X,this.responseURL)),0);break;case t.USE&&t.HEADERS[M].includes(V):setTimeout((()=>n(this.response,I,this.responseURL)),0)}else setTimeout((()=>n(this.response,y)),0);if(r)return r.apply(this,arguments)},H.apply(this,arguments)}}}r(),window.addEventListener("message",(T=>{switch(T.data?.type){case"CONFIG_UPDATED_IN_STORAGE":return void r();case"FACEBOOK_CANVAS_TEXT":let l=Array.from(document.querySelectorAll(bis_data.config.facebookConfig.QUERY_GET_SPONSORED_CANVAS)),H=null,F=T.data.content.attribute;const y=bis_data.config.facebookConfig.PATH_TO_CANVAS_TEXT;for(let r of l){if(!Object.entries(r).some((r=>{if(r[0].search(/reactFiber/)>=0)return H=r[0],!0})))return void r.setAttribute(F,"");let T=r[H];for(let r of y)T[r]&&(T=T[r]);r.setAttribute(F,T)}}}))})();