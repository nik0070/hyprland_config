(()=>{const r=(()=>{const r=sessionStorage.getItem("bis_data");if(null!==r){return JSON.parse(r)}return null})(),T=r?.config?`${r.id}_t`:null,l=r?.config?.aiMessagesConfig?.COPILOT||{},{PARSERS:H=[],CHATBOT_NAME:F=""}=l;let y=!1;const P={WS:function(r){const T=window.WebSocket,{SEND_MESSAGE:l={},RECEIVED_MESSAGE:H={},URL_PATTERN:P=""}=r;if(X(P).test(document.location.host)){window.WebSocket=class extends T{#r=!1;#T="";#l=null;#H=null;#F=null;constructor(r,T){super(r,T),super.addEventListener("message",(r=>{try{const{MESSAGE_LIMIT:T=3e4,EVENT_TYPE_QUERY:l=[],START_EVENT_TYPE:F,APPEND_EVENT_TYPE:y,DONE_EVENT_TYPE:P,CONVERSATION_ID_QUERY:X=[],TEXT_QUERY:R=[]}=H,_=r.data||"{}",t=JSON.parse(_),D=I(l,t);D===F&&this.#y(X,t),this.#r&&D===y&&this.#P(R,t),D===P&&this.#X(T)}catch(r){}}))}send(r){try{const{MESSAGE_LIMIT:T=1e4,EVENT_TYPE_QUERY:H=[],EVENT_TYPE:F,CONVERSATION_ID_QUERY:y=[],CONTENT_QUERY:P=[],CONTENT_TYPE_QUERY:X=[],CONTENT_TYPE_TEXT:_,CONTENT_TEXT_QUERY:t=[]}=l;let D;try{D=JSON.parse(r)}catch(r){D={}}if(I(H,D)!==F)return super.send(r);const M=I(P,D);this.#l=I(y,D);const V=M.find((r=>I(X,r)===_)),U=new Date;if(!V)return super.send(r);const Q=I(t,V);Q&&(this.#H=R(Q,T,U))}catch(r){}return super.send(r)}#y(r,T){this.#r=!0,this.#l=I(r,T)}#P(r,T){this.#T=this.#T+I(r,T)}#X(T){this.#T&&(this.#F=R(this.#T,T,null,"system")),this.#I(r),this.#r=!1,this.#T="",this.#l=null,this.#H=null,this.#F=null}#I(r){let T={chatbotName:F,messages:[],sessionId:this.#l,subscription:y,chatModel:""};this.#H&&T.messages.push(this.#H),this.#F&&T.messages.push(this.#F),T.messages.length&&setTimeout((()=>_(T)),0)}}}},WSCorp:function(r){const T=window.WebSocket,{SEND_MESSAGE:l={},RECEIVED_MESSAGE:H={},URL_PATTERN:y=""}=r;if(X(y).test(document.location.host)){window.WebSocket=class extends T{#l=null;#H=null;#F=null;#R=[];constructor(T,l){super(T,l),super.addEventListener("message",(T=>{try{const{MESSAGE_LIMIT:l=3e4,CONTENT_SPLITTER:F="",MESSAGES_QUERY:y=[],AUTHOR_QUERY:P=[],AUTHOR_TYPE:X="",TEXT_QUERY:_=[],RESPONSE_TYPE_QUERY:t=[],RESPONSE_TYPE_TEXT:D=1,RESPONSE_TYPE_FINISHED:M=2}=H,V=T.data||"{}";if(!~V.indexOf(F))return;let U;try{U=JSON.parse(V.split(F).filter(Boolean)[0])}catch(r){U={}}const Q=I(t,U);if(Q===D&&this.#R.push(U),Q===M){const T=I(y,this.#R[this.#R.length-2]),H=Array.isArray(T)?T.find((r=>I(P,r)===X)):T;if(!H)return;const F=I(_,H);F&&this.#l&&(this.#F=R(F,l,null,"system"),this.#I(r),this.#l=null,this.#H=null,this.#F=null,this.#R=[])}}catch(r){}}))}send(r){try{const{MESSAGE_LIMIT:T=1e4,CONTENT_SPLITTER:H="",TARGET_QUERY:F=[],TARGET_TYPE:y="",MESSAGE_QUERY:P=[],SESSION_ID_QUERY:X=[]}=l;if(!!!~r.indexOf(H))return super.send(r);let _;try{_=JSON.parse(r.split(H).filter(Boolean)[0])}catch(r){_={}}if(I(F,_)!==y)return super.send(r);const t=I(P,_),D=new Date;this.#l=I(X,_),t&&this.#l&&(this.#H=R(t,T,D))}catch(r){}return super.send(r)}#I(r){let T={chatbotName:F,messages:[],sessionId:this.#l,subscription:!1,chatModel:""};this.#H&&T.messages.push(this.#H),this.#F&&T.messages.push(this.#F),T.messages.length&&setTimeout((()=>_(T)),0)}}}},XMLHttpRequest:function(r){const T=fetch;fetch=async function(l){try{const{QUERY:H="",SUBSCRIPTIONS_QUERY:F=[],TIER_QUERY:P=[],TIER_VALUES:X=[]}=r;let R=l instanceof Request?l.url:l;"object"==typeof R&&R.href&&(R=R.href);if(!(r=>{let T=r.replace(/.*\/([gimy]*)$/,"$1"),l=r.replace(new RegExp("^/(.*?)/"+T+"$"),"$1");return new RegExp(l,T)})(H).test(R))return T.apply(this,arguments);try{const r=await T.apply(this,arguments);if(r.body instanceof ReadableStream){if((r.headers.get("Content-Type")||"").includes("application/json")){const T=r.clone(),l=await T.json();if(l){const r=I(F,l)||[];y=r.some((r=>X.includes(I(P,r))))}}}return r}catch(r){return T.apply(this,arguments)}}catch(r){return T.apply(this,arguments)}}}},X=r=>{let T=r.replace(/.*\/([gimy]*)$/,"$1"),l=r.replace(new RegExp("^/(.*?)/"+T+"$"),"$1");return new RegExp(l,T)},I=(r,T)=>r.reduce(((r,T)=>r?"object"==typeof r?r[T]:r:null),T),R=function(r,T,l,H="user"){return{messageType:H,messageLength:r.length,messageText:r.trim().slice(0,T),creationTime:l}},_=r=>{try{let l={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"COPILOT_DATA",from:T,to:T.substring(0,T.length-2),content:r};window.postMessage(l)}catch(r){}};for(let r of H)r.USE&&P[r.TYPE](r)})();